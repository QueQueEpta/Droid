energy-monitoring-dataset-generator/
├── configs/              # Папка для хранения файлов конфигурации (.json)
│   └── example_config.json
├── datasets/             # Папка для сохранения сгенерированных датасетов (.csv)
├── devices/              # Папка с моделями устройств (без изменений)
│   ├── ... (все файлы устройств)
│   └── index.js
├── public/               # Папка для файлов веб-интерфейса
│   ├── index.html
│   ├── styles.css
│   └── script.js
├── generate_dataset.js   # Основной скрипт генерации (нужно модифицировать)
├── scenario_generator.js # Логика сценариев (без изменений)
├── data_writer.js        # Утилита для записи CSV (без изменений)
├── server.js             # НОВЫЙ: Веб-сервер Express для UI и управления
├── package.json          # (добавим express)
└── README.md             # 

# Генератор Датасетов Мониторинга Энергопотребления

Этот проект генерирует синтетические датасеты энергопотребления с разметкой *индивидуальной мощности* каждого устройства. Датасеты предназначены для обучения моделей машинного обучения, в частности для задач Non-Intrusive Load Monitoring (NILM). Проект также включает веб-сервер для управления конфигурациями и запуска процесса генерации.

## Функционал

*   Генерация агрегированных данных мощности и тока во времени.
*   Автоматическая разметка **индивидуальной мощности** для каждого активного устройства в каждый момент времени.
*   Использование настраиваемых моделей устройств с различными профилями потребления (из папки `devices/`), включая:
    *   Различные формы волны (`constant`, `sinusoidal`, `random`, `motor`).
    *   Симуляцию пикового пускового тока.
*   Автоматическое управление сценариями включения/выключения устройств (`scenario_generator.js`) на основе вероятностных параметров.
*   Настраиваемые параметры генерации (длительность, частота дискретизации, используемые устройства, фоновый шум, параметры сценариев и т.д.) через JSON-файлы конфигурации (в папке `configs/`).
*   Сохранение данных в формате CSV с использованием эффективной потоковой записи.
*   Веб-сервер (`server.js`) с API для:
    *   Просмотра списка конфигураций.
    *   Просмотра и сохранения новых версий конфигураций (с метаданными).
    *   Асинхронного запуска процесса генерации датасета.
*   Обслуживание статического веб-интерфейса (из папки `public/`, сами файлы UI не включены в этот обзор).

## Структура Проекта

*   `configs/`: Директория для хранения файлов конфигурации симуляции (в формате JSON).
    *   `config.json` (Пример): Базовый файл конфигурации.
    *   `config_edited_*.json` (Пример): Файлы, сохраненные через веб-интерфейс.
*   `datasets/`: Директория для сохранения сгенерированных CSV датасетов (создается автоматически).
*   `devices/`: Модули, описывающие характеристики и поведение отдельных устройств.
    *   `Device.js`: Базовый класс для всех моделей устройств.
    *   `device1.js`, `device2.js`, ...: Конкретные экземпляры устройств.
    *   `index.js`: Собирает и экспортирует все экземпляры устройств и утилиты для них.
*   `public/`: Директория для статических файлов веб-интерфейса (HTML, CSS, JS). *Содержимое не предоставлено.*
*   `generate_dataset.js`: Основной скрипт для запуска генерации датасета из командной строки.
*   `data_writer.js`: Модуль для эффективной потоковой записи сгенерированных данных в CSV файл (использует `fast-csv`).
*   `scenario_generator.js`: Модуль, отвечающий за симуляцию реалистичного использования (включения/выключения) устройств во времени.
*   `server.js`: Скрипт веб-сервера (Express.js) для управления конфигурациями и запуском генерации через API.
*   `package.json`: Описание проекта, зависимости и скрипты npm.
*   `package-lock.json`: Фиксирует версии зависимостей.
*   `README.md`: Данный файл документации.

## Установка

1.  Убедитесь, что у вас установлен Node.js (версия 14 или выше рекомендуется).
2.  Клонируйте репозиторий:
    ```bash
    git clone <your-repo-url> energy-monitoring-dataset-generator
    cd energy-monitoring-dataset-generator
    ```
3.  Установите зависимости:
    ```bash
    npm install
    ```

## Использование

### 1. Генерация из командной строки:

1.  Создайте или отредактируйте файл конфигурации в папке `configs/` (например, `configs/my_config.json`). Укажите желаемые параметры: длительность (`simulationDurationHours`), шаг времени (`timeStepMs`), список устройств (`devicesToInclude`), параметры сценария (`scenarioParams`), уровень шума (`noiseLevelWatts`).
2.  Запустите генерацию, указав путь к вашему конфигу и желаемый путь к выходному файлу:
    ```bash
    node generate_dataset.js --config ./configs/my_config.json --output ./datasets/my_dataset.csv
    ```
3.  Сгенерированный датасет появится в указанном выходном файле (например, `./datasets/my_dataset.csv`).

### 2. Использование Веб-интерфейса (управление и запуск):

1.  Запустите веб-сервер:
    ```bash
    npm start
    ```
    или
    ```bash
    node server.js
    ```
2.  Откройте в браузере `http://localhost:3000` (или другой порт, если указан `PORT`).
3.  Через веб-интерфейс (который использует API сервера) вы можете:
    *   Просматривать существующие конфигурации из папки `configs/`.
    *   Редактировать конфигурацию и сохранять ее как новый файл (с добавлением комментария и временной метки).
    *   Выбирать конфигурацию и запускать процесс генерации датасета в фоновом режиме. Имя выходного файла будет сгенерировано автоматически на основе имени конфига и временной метки и сохранено в папку `datasets/`.

## Формат Выходного Файла (CSV)

Сгенерированный CSV файл содержит следующие колонки:

*   `timestamp`: Временная метка (Unix timestamp в миллисекундах).
*   `aggregated_power`: Суммарная активная мощность всех включенных устройств + фоновый шум (Вт). Округлено до 2 знаков после запятой.
*   `aggregated_current`: Суммарный ток (А). Расчет может быть упрощенным, основан на суммарной мощности. Округлено до 2 знака после запятой.
*   **`<sanitized_device_name1>_power`**: Индивидуальная активная мощность устройства 1 (Вт) в данный момент времени. Имя колонки формируется из имени устройства (поле `name` в `Device.js`), очищенного от пробелов и спецсимволов (например, `WashingMachine_power`). Округлено до 2 знаков после запятой.
*   **`<sanitized_device_name2>_power`**: Индивидуальная активная мощность устройства 2 (Вт).
*   ... и так далее для **каждого** устройства, указанного в массиве `devicesToInclude` в файле конфигурации.

**Пример строки:**

```csv
timestamp,aggregated_power,aggregated_current,AsyncEngine_power,Conditioneer_power,Freezebox_power
1678886400000,2115.34,9.62,0.00,1805.12,310.22
1678886401000,3410.11,15.50,3100.89,0.00,309.22